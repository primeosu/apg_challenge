(($) ->
  # fire an event when a file is selected
  $(document).on 'change', '.btn-file :file', ->
    $input = $(this)
    numFiles = if $input.get(0).files then $input.get(0).files.length else 1
    label = $input.val().replace(/\\/g, '/').replace(/.*\//, '')
    $input.trigger 'fileselect', [numFiles, label]

  # doc ready
  $ ->
    # update file select box with the filename and remove any previous
    # validation errors
    $('.btn-file :file').on 'fileselect', (event, numFiles, label) ->
      $(this)
        .parents('.input-group')
        .find(':text')
        .val(label)
        .parents('.form-group')
        .removeClass('has-error')
        .find('.help-block')
        .css('visibility', 'hidden')

    # look for error messages and style the input field with them
    $alert = $('.alert-error')
    if $alert.length
      $('.file-upload')
        .addClass('has-error')
        .append $('<p>', {
          class: 'help-block'
          text: $alert.text()
        })
      $alert.remove()
) jQuery
